#############################################################################################################
## MOD Title:		Update phpBB Garage 1.0.5 -> phpBB Garage 1.2.0
## MOD Author: poyntesm < esmond.poynton[at]gmail[dot]com > (Esmond Poynton) http://forums.phpbbgarage.com
## MOD Description:
##			Updates phpBB Garage From 1.0.5 To 1.2.0
##
## MOD Version:		1.2.0
## 
## Installation Level:	Easy
## Installation Time:	10 Minutes
## Files To Edit: (4)
##			templates/subSilver/viewtopic_body.tpl
##			templates/subSilver/memberlist_body.tpl
##			language/lang_english/lang_main.php
##			includes/usercp_viewprofile.php
##			includes/page_tail.php
##			viewtopic.php
##			memberlist.php
##			templates/subSilver/subSilver.cfg
##
## Included Files: (84)
##			Install Garage.txt
##			Upgrade.txt
##			contrib/Install Garage PCP.txt
##			contrib/profilcp/
##			contrib/templates/
## 			root/garage.php
## 			root/install_garage.php
##			root/admin/admin_garage_business.php
##			root/admin/admin_garage_categories.php
##			root/admin/admin_garage_config.php
##			root/admin/admin_garage_models.php
##			root/admin/admin_garage_permissions.php
##			root/admin/admin_garage_tools.php
##			root/includes/functions_garage.php
##			root/language/lang_english/lang_garage.php
##			root/language/lang_english/lang_garage_error.php
##			root/templates/subSilver/garage.tpl
##			root/templates/subSilver/garage_browse.tpl
##			root/templates/subSilver/garage_browse_insurance.tpl
##			root/templates/subSilver/garage_edit_comment.tpl
##			root/templates/subSilver/garage_error.tpl
##			root/templates/subSilver/garage_footer.tpl
##			root/templates/subSilver/garage_header.tpl
##			root/templates/subSilver/garage_insurance.tpl
##			root/templates/subSilver/garage_manage_vehicle_gallery.tpl
##			root/templates/subSilver/garage_menu.tpl
##			root/templates/subSilver/garage_modification.tpl
##			root/templates/subSilver/garage_pending.tpl
##			root/templates/subSilver/garage_quartermile.tpl
##			root/templates/subSilver/garage_quartermile_table.tpl
##			root/templates/subSilver/garage_reassign_business.tpl
##			root/templates/subSilver/garage_rollingroad.tpl
##			root/templates/subSilver/garage_rollingroad_table.tpl
##			root/templates/subSilver/garage_search.tpl
##			root/templates/subSilver/garage_user_submit.tpl
##			root/templates/subSilver/garage_user_submit_make.tpl
##			root/templates/subSilver/garage_user_submit_model.tpl
##			root/templates/subSilver/garage_vehicle.tpl
##			root/templates/subSilver/garage_vehicle_select_javascript.tpl
##			root/templates/subSilver/garage_view_garage_business.tpl
##			root/templates/subSilver/garage_view_guestbook.tpl
##			root/templates/subSilver/garage_view_insurance_business.tpl
##			root/templates/subSilver/garage_view_modification.tpl
##			root/templates/subSilver/garage_view_shop_business.tpl
##			root/templates/subSilver/garage_view_vehicle.tpl
##			root/templates/subSilver/admin/garage_business.tpl
##			root/templates/subSilver/admin/garage_business_edit.tpl
##			root/templates/subSilver/admin/garage_category.tpl
##			root/templates/subSilver/admin/garage_category_delete_body.tpl
##			root/templates/subSilver/admin/garage_category_edit_body.tpl
##			root/templates/subSilver/admin/garage_config.tpl
##			root/templates/subSilver/admin/garage_message.tpl
##			root/templates/subSilver/admin/garage_model.tpl
##			root/templates/subSilver/admin/garage_model_delete.tpl
##			root/templates/subSilver/admin/garage_model_edit.tpl
##			root/templates/subSilver/admin/garage_orphans.tpl
##			root/templates/subSilver/admin/garage_permissions.tpl
##			root/templates/subSilver/admin/garage_tools.tpl
##			root/templates/subSilver/images/garage_camera.gif
##			root/templates/subSilver/images/garage_slip.gif
##			root/templates/subSilver/images/lang_english/garage_add_insurance.gif
##			root/templates/subSilver/images/lang_english/garage_add_modification.gif
##			root/templates/subSilver/images/lang_english/garage_add_quartermile.gif
##			root/templates/subSilver/images/lang_english/garage_add_rollingroad.gif
##			root/templates/subSilver/images/lang_english/garage_browse.gif
##			root/templates/subSilver/images/lang_english/garage_create_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_delete.gif
##			root/templates/subSilver/images/lang_english/garage_delete_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_edit.gif
##			root/templates/subSilver/images/lang_english/garage_edit_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_garage_review.gif
##			root/templates/subSilver/images/lang_english/garage_insurance_review.gif
##			root/templates/subSilver/images/lang_english/garage_main_menu.gif
##			root/templates/subSilver/images/lang_english/garage_main_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_manage_gallery.gif
##			root/templates/subSilver/images/lang_english/garage_no_thumb.gif
##			root/templates/subSilver/images/lang_english/garage_quartermile_table.gif
##			root/templates/subSilver/images/lang_english/garage_rollingroad_table.gif
##			root/templates/subSilver/images/lang_english/garage_search.gif
##			root/templates/subSilver/images/lang_english/garage_shop_review.gif
##			root/templates/subSilver/images/lang_english/garage_view_vehicle.gif
##			root/templates/subSilver/images/lang_english/icon_garage.gif
##			upgrade/upgrade_garage-1.0.0.php
##			upgrade/upgrade_garage-1.0.0.txt
##			upgrade/upgrade_garage-1.0.2.php
##			upgrade/upgrade_garage-1.0.2.txt
##			upgrade/upgrade_garage-1.0.3.php
##			upgrade/upgrade_garage-1.0.3.php
##			upgrade/upgrade_garage-1.0.4.txt
##			upgrade/upgrade_garage-1.0.4.txt
##			upgrade/upgrade_garage-1.0.5.txt
##			upgrade/upgrade_garage-1.0.5.txt
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2 or any later version
######################################################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
###################################################################################### 
## Author Notes: 
##
##	- This Mod Was Inspired By IPB Based Garage By Matthew C. Veno
##
######################################################################################
## MOD History: 
##   27-02-2006 - Version 1.0.2
##	- Fix javascript error on adding a new model
##	- Fix setting private permissions
##	- Fix offset year
##	- Fix userlink in viewing insurance business
##
##   01-02-2006 - Version 1.0.0
##	- Version Submitted To phpBB.com's MOD DB. (Resubmitted with changes 01-02-2006)
## 			
###################################################################################### 
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD 
###################################################################################### 

#
#-----[ COPY ]------------------------------------------
#
copy upgrade/upgrade_garage-1.0.5.php TO upgrade_garage-1.0.5.php
copy root/*.* TO *.*

#
#-----[ DIY INSTRUCTIONS ]------------------------------------------
#
Open in your web browser and run upgrade_garage-1.0.5.php
Delete upgrade_garage-1.0.5.php if it ran succesfull

# 
#-----[ OPEN ]----- 
# 
templates/subSilver/subSilver.cfg

#
#-----[ FIND ]------------------------------------------
#
$images['garage_no_thumb']		= "$current_template_images/{LANG}/garage_no_thumb.gif";

#
#-----[ AFTER, ADD ]------------------------------------------
#
$images['garage_show_details']		= "$current_template_images/{LANG}/garage_show_details.gif";
$images['garage_hide_details']		= "$current_template_images/{LANG}/garage_hide_details.gif";
$images['garage_move_up']		= "$current_template_images/{LANG}/garage_move_up.gif";
$images['garage_move_down']		= "$current_template_images/{LANG}/garage_move_down.gif";
$images['garage_set_approved']		= "$current_template_images/{LANG}/garage_set_approved.gif";
$images['garage_set_pending']		= "$current_template_images/{LANG}/garage_set_pending.gif";

# 
#-----[ OPEN ]----- 
# 
memberlist.php

#
#-----[ FIND ]------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Garage ----------------------------------------------------------------------------------------------------------

#
#-----[ FIND ]------------------------------------------
#
	'L_WEBSITE' => $lang['Website'],
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
	'L_GARAGE' => $lang['Garage'],
//-- mod finsh : Garage ----------------------------------------------------------------------------------------------------

#
#-----[ FIND ]------------------------------------------
#
	default:
		$order_by = "user_regdate $sort_order LIMIT $start, " . $board_config['topics_per_page'];
		break;
}

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- modify

#
#-----[ FIND ]------------------------------------------
#
$sql = "SELECT username, user_id, user_viewemail, user_posts, user_regdate, user_from, user_website, user_email, user_icq, user_aim, user_yim, user_msnm, user_avatar, user_avatar_type, user_allowavatar 
#-----[ IN-LINE FIND ]------------------------------------------
#
user_allowavatar
#
#-----[ IN-LINE AFTER, ADD ]------------------------------------------
#
, g.id as garage_id

#
#-----[ FIND ]------------------------------------------
#
	FROM " . USERS_TABLE . "
#
#-----[ AFTER, ADD ]------------------------------------------
#
		LEFT JOIN " . GARAGE_TABLE ." g ON ( g.member_id = user_id and g.main_vehicle = 1)

#
#-----[ FIND ]------------------------------------------
#
	ORDER BY $order_by";

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod finsh : Garage ----------------------------------------------------------------------------------------------------

#
#-----[ FIND ]------------------------------------------
#
		$search = '<a href="' . $temp_url . '">' . sprintf($lang['Search_user_posts'], $username) . '</a>';
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
		$garage_img = ( $row['garage_id'] ) ?'<a href="' . append_sid("garage.$phpEx?mode=browse&search=yes&user=" . $row['username'] . "") . '"><img src="' . $images['icon_garage'] . '" alt="'.$lang['View_Users_Garage'].'" title="'.$lang['View_Users_Garage'].'" border="0" /></a>' : '';
//-- mod finsh : Garage ----------------------------------------------------------------------------------------------------

#
#-----[ FIND ]------------------------------------------
#
			'WWW_IMG' => $www_img,
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
			'GARAGE_IMG' => $garage_img,
//-- mod finsh : Garage ----------------------------------------------------------------------------------------------------

# 
#-----[ OPEN ]----- 
# 
viewtopic.php

#
#-----[ FIND ]------------------------------------------
#
	$garage_id = $postrow[$i]['garage_id'];
#
#-----[ AFTER, ADD ]------------------------------------------
#
	$garage_img = ( $postrow[$i]['garage_id'] ) ?'<a href="' . append_sid("garage.$phpEx?mode=browse&search=yes&user=".$postrow[$i]['username']."") . '"><img src="' . $images['icon_garage'] . '" alt="'.$lang['View_Users_Garage'].'" title="'.$lang['View_Users_Garage'].'" border="0" /></a>' : '';


#
#-----[ FIND ]------------------------------------------
#
		'POSTER_CAR_MAKE' => $poster_car_make,

#
#-----[ BEFORE, ADD ]------------------------------------------
#
		'GARAGE_IMG' => $garage_img,

# 
#-----[ OPEN ]----- 
# 
includes/page_tail.php

#
#-----[ FIND ]------------------------------------------
#
if ( $userdata['user_level'] == ADMIN )
{
	$sql = "SELECT count(*) AS total
		FROM ". GARAGE_QUARTERMILE_TABLE ." qm
		WHERE qm.pending = 1";
	if( !($result = $db->sql_query($sql)) )
	{
		message_die(GENERAL_ERROR, 'Could not query information', '', __LINE__, __FILE__, $sql);
	}

	$count = $db->sql_fetchrow($result);
	$db->sql_freeresult($result);

	$temp_url = append_sid("garage.$phpEx?mode=garage_pending");
	//We Have At Least One Pending Image So Display Link
	if ( $count['total'] > 0 )
	{
		$pending_link = ( $userdata['user_level'] == ADMIN || $userdata['full_mod'] == FULL_MOD ) ? '<a href="'.$temp_url.'">' . $lang['Pending_Items'] . '</a>&nbsp;&nbsp;' : '';
	}
	//Not Found A Pending Item So Lets Keep Checking Other Types
	else
	{
		$sql = "SELECT count(*) AS total
			FROM ". GARAGE_ROLLINGROAD_TABLE ." rr
			WHERE rr.pending = 1";
		if( !($result = $db->sql_query($sql)) )
		{
			message_die(GENERAL_ERROR, 'Could not query pics information', '', __LINE__, __FILE__, $sql);
		}

		$count = $db->sql_fetchrow($result);
		$db->sql_freeresult($result);
		//We Have At Least One Pending Image So Display Link
		if ( $count['total'] > 0 )
		{
			$pending_link = ( $userdata['user_level'] == ADMIN || $userdata['full_mod'] == FULL_MOD ) ? '<a href="'.$temp_url.'">' . $lang['Pending_Items'] . '</a>&nbsp;&nbsp;' : '';
		}
		//Still Not Found A Pending Item So Lets Keep Checking Other Types
		else
		{
			$sql = "SELECT count(*) AS total
				FROM ". GARAGE_BUSINESS_TABLE ." bus
				WHERE bus.pending = 1";
			if( !($result = $db->sql_query($sql)) )
			{
				message_die(GENERAL_ERROR, 'Could not query pics information', '', __LINE__, __FILE__, $sql);
			}

			$count = $db->sql_fetchrow($result);
			$db->sql_freeresult($result);
			if ( $count['total'] > 0 )
			{
				$pending_link = ( $userdata['user_level'] == ADMIN || $userdata['full_mod'] == FULL_MOD ) ? '<a href="'.$temp_url.'">' . $lang['Pending_Items'] . '</a>&nbsp;&nbsp;' : '';
			}
			//Still Not Found A Pending Item So Lets Keep Checking Other Types
			else
			{
				$sql = "SELECT count(*) AS total
					FROM ". GARAGE_MODELS_TABLE ." models
					WHERE models.pending = 1";
				if( !($result = $db->sql_query($sql)) )
				{
					message_die(GENERAL_ERROR, 'Could not query pics information', '', __LINE__, __FILE__, $sql);
				}

				$count = $db->sql_fetchrow($result);
				$db->sql_freeresult($result);
				if ( $count['total'] > 0 )
				{
					$pending_link = ( $userdata['user_level'] == ADMIN || $userdata['full_mod'] == FULL_MOD ) ? '<a href="'.$temp_url.'">' . $lang['Pending_Items'] . '</a>&nbsp;&nbsp;' : '';
				}
				else
				{
					$sql = "SELECT count(*) AS total
						FROM ". GARAGE_MAKES_TABLE ." makes
						WHERE makes.pending = 1";
					if( !($result = $db->sql_query($sql)) )
					{
						message_die(GENERAL_ERROR, 'Could not query pics information', '', __LINE__, __FILE__, $sql);
					}

					$count = $db->sql_fetchrow($result);
					$db->sql_freeresult($result);
					if ( $count['total'] > 0 )
					{
						$pending_link = ( $userdata['user_level'] == ADMIN || $userdata['full_mod'] == FULL_MOD ) ? '<a href="'.$temp_url.'">' . $lang['Pending_Items'] . '</a>&nbsp;&nbsp;' : '';
					}
					//Out Of Luck No More Tables To Check
					else
					{
						$pending_link = '';
					}
				}
			}
		}
	}
}
#
#-----[ REPLACE WITH ]------------------------------------------
#
include_once($phpbb_root_path . 'includes/class_garage.' . $phpEx);
if ( in_array($userdata['user_level'], array(ADMIN, MOD)) )
{
	//If Pending Items Exist Then Create Link
	if ( $garage->check_pending_items() )
	{
		$temp_url = append_sid("garage.$phpEx?mode=garage_pending");
		$pending_link = '<a href="'.$temp_url.'">' . $lang['Pending_Items'] . '</a>&nbsp;&nbsp;';
		$template->assign_vars(array(
			'PENDING_LINK' => $pending_link)
		);
	}
}

#
#-----[ FIND ]------------------------------------------
#
//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
	'PENDING_LINK' => $pending_link,
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

#
#-----[ REPLACE WITH ]------------------------------------------
#
# Replace with a blank line

# 
#-----[ OPEN ]----- 
# 
includes/usercp_viewprofile.php

#
#-----[ FIND ]------------------------------------------
#
require($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_garage.' . $phpEx);
require($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_garage_error.' . $phpEx);
require($phpbb_root_path . 'includes/functions_garage.' . $phpEx);

$sql = "SELECT g.*, images.*, makes.make, models.model, user.username, user.user_avatar_type,
	user.user_allowavatar, user.user_avatar,
        count(mods.id) AS total_mods,  
        ( SUM(mods.price) + SUM(mods.install_price) ) AS total_spent 
        FROM " . GARAGE_TABLE . " AS g  
		LEFT JOIN " . USERS_TABLE ." AS user ON g.member_id = user.user_id
                LEFT JOIN " . GARAGE_MODS_TABLE . " AS mods ON g.id = mods.garage_id
                LEFT JOIN " . GARAGE_MAKES_TABLE . " AS makes ON g.make_id = makes.id
                LEFT JOIN " . GARAGE_MODELS_TABLE . " AS models ON g.model_id = models.id
		LEFT JOIN " . GARAGE_IMAGES_TABLE . " AS images ON images.attach_id = g.image_id
        WHERE g.member_id = " . $profiledata['user_id'] . " AND g.main_vehicle = 1
                GROUP BY g.id";

if ( !($result = $db->sql_query($sql)) )
{
       	message_die(GENERAL_ERROR, 'Could Not Select Vehicle Data', '', __LINE__, __FILE__, $sql);
}

$vehicle_row = $db->sql_fetchrow($result);

if ( $db->sql_numrows($result) > 0 )
{
	$template->assign_block_vars('garage_vehicle', array());
	$total_spent = $vehicle_row['total_spent'] ? $vehicle_row['total_spent'] : 0;

	//Display Just Thumbnails Of All Images Or Just One Main Image
	if ( $garage_config['profile_thumbs'] == 1 )
	{
	       	$gallery_query = "SELECT gallery.id, images.attach_id, images.attach_hits, images.attach_ext, 
                        	        images.attach_file, images.attach_thumb_location, images.attach_is_image,
                	                images.attach_location
                                     FROM " . GARAGE_IMAGES_TABLE . " AS images 
					LEFT JOIN " . GARAGE_GALLERY_TABLE . " AS gallery ON images.attach_id = gallery.image_id 
                                     	LEFT JOIN " . GARAGE_TABLE . " AS garage ON gallery.garage_id = garage.id 
                                     WHERE garage.id = " . $vehicle_row['id'] ." AND gallery.garage_id = " . $vehicle_row['id'] . ";";
		if ( !($result = $db->sql_query($gallery_query)) )
      		{
         		message_die(GENERAL_ERROR, 'Could Not Select Image Data For Vehicle', '', __LINE__, __FILE__, $sql);
	      	}
	
        	while ( $gallery_data = $db->sql_fetchrow($result) )
	       	{
            		if ( $gallery_data['attach_is_image'] )
           		{
                		// Do we have a thumbnail?  If so, our job is simple here :)
				if ( (empty($gallery_data['attach_thumb_location']) == FALSE) AND ($gallery_data['attach_thumb_location'] != $gallery_data['attach_location']) AND ( $vehicle_images_found <= 12) )
                		{
                    			// Form the image link
					$thumb_image = GARAGE_UPLOAD_PATH . $gallery_data['attach_thumb_location'];
					$id = $gallery_data['attach_id'];
					$title = $gallery_data['attach_file'];
					$hilite_image .= '<a href=garage.'.$phpEx.'?mode=view_gallery_item&amp;type=garage_gallery&amp;image_id='. $id .' title=' . $title .' target="_blank"><img hspace="5" vspace="5" src="' . $thumb_image .'" class="attach"  /></a> ';
               			} 
			}
	        }

		$mod_query = "SELECT m.*,images.attach_id, images.attach_hits, images.attach_ext, 
                        images.attach_file, images.attach_thumb_location, images.attach_is_image,
                        images.attach_location
         		FROM " . GARAGE_MODS_TABLE . " as m
                        LEFT JOIN " . GARAGE_IMAGES_TABLE . " AS images ON images.attach_id = m.image_id
	       		WHERE garage_id = " . $vehicle_row['id'] .";";
		if ( !($result = $db->sql_query($mod_query)) )
      		{
         		message_die(GENERAL_ERROR, 'Could Not Select Image Data For Vehicle', '', __LINE__, __FILE__, $sql);
	      	}

        	while ( $mod_gallery = $db->sql_fetchrow($result) )
	       	{
            		if ( $mod_gallery['attach_is_image'] )
           		{
                		// Do we have a thumbnail?  If so, our job is simple here :)
				if ( (empty($mod_gallery['attach_thumb_location']) == FALSE) AND ($mod_gallery['attach_thumb_location'] != $gallery_data['attach_location']) AND ( $vehicle_images_found <= 12) )
                		{
                    			// Form the image link
					$thumb_image = GARAGE_UPLOAD_PATH . $mod_gallery['attach_thumb_location'];
					$id = $mod_gallery['attach_id'];
					$title = $mod_gallerya['attach_file'];
					$hilite_image .= '<a href=garage.'.$phpEx.'?mode=view_gallery_item&amp;type=garage_gallery&amp;image_id='. $id .' title=' . $title .' target="_blank"><img hspace="5" vspace="5" src="' . $thumb_image .'" class="attach"  /></a> ';
               			} 
			}
	        }
	}
	//Looks Like We Only Need To Draw One Main Image
	else
	{
		if ( ($vehicle_row['image_id']) AND ($vehicle_row['attach_is_image']) AND (!empty($vehicle_row['attach_thumb_location'])) AND (!empty($vehicle_row['attach_location'])) )
		{
			// Check to see if this is a remote image
			if ( preg_match( "/^http:\/\//i", $vehicle_row['attach_location']) )
			{
				$image = $vehicle_row['attach_location'];
				$id = $vehicle_row['attach_id'];
				$title = $vehicle_row['attach_file'];
				$total_image_views = $vehicle_row['attach_hits'];
				$hilite_image = '<a href=garage.'.$phpEx.'?mode=view_gallery_item&amp;type=garage_mod&amp;image_id='. $id .' title=' . $title .' target="_blank"><img hspace="5" vspace="5" src="' . $image .'" class="attach"  /></a>';
			}
			else
			{
				$image = GARAGE_UPLOAD_PATH . $vehicle_row['attach_location'];
				$id = $vehicle_row['attach_id'];
				$title = $vehicle_row['attach_file'];
				$total_image_views = $vehicle_row['attach_hits'];
				$hilite_image = '<a href=garage.'.$php.'?mode=view_gallery_item&amp;type=garage_mod&amp;image_id='. $id .' title=' . $title .' target="_blank"><img hspace="5" vspace="5" src="' . $image .'" class="attach"  /></a>';
			}
		}
	}

	$garage_img ='<a href="' . append_sid("garage.$phpEx?mode=browse&search=yes&user=".$profiledata['username']."") . '"><img src="' . $images['icon_garage'] . '" alt="'.$lang['Garage'].'" title="'.$lang['Garage'].'" border="0" /></a>';

	$template->assign_vars(array(
		'L_VEHICLE' => $lang['Vehicle'],
		'L_GARAGE' => $lang['Garage'],
		'L_COLOUR' => $lang['Colour'],
		'L_MILEAGE' => $lang['Mileage'],
		'L_PRICE' => $lang['Purchased_Price'],
		'L_TOTAL_MODS' => $lang['Total_Mods'],
		'L_TOTAL_SPENT' => $lang['Total_Spent'],
		'L_DESCRIPTION' => $lang['Description'],
		'L_SEARCH_USER_GARAGE' => $lang['Search_User_Garage'],
		'YEAR' => $vehicle_row['year'],
		'MAKE' => $vehicle_row['make'],
		'MODEL' => $vehicle_row['model'],
       		'COLOUR' => $vehicle_row['color'],
	       	'HILITE_IMAGE' => $hilite_image,
        	'MILEAGE' => $vehicle_row['mileage'],
	        'MILEAGE_UNITS' => $vehicle_row['mileage_unit'],
        	'PRICE' => $vehicle_row['price'],
	        'CURRENCY' => $vehicle_row['currency'],
        	'TOTAL_MODS' => $vehicle_row['total_mods'],
	        'TOTAL_SPENT' => $total_spent,
        	'TOTAL_VIEWS' => $vehicle_row['views'],
	        'DESCRIPTION' => $vehicle_row['comments'],
	        'GARAGE_IMG' => $garage_img,
		'U_SEARCH_USER_GARAGE' => append_sid("garage.$phpEx?mode=browse"))
	);
}

#
#-----[ REPLACE WITH ]------------------------------------------
#
if(empty($board_config['default_lang']))
{
	$board_config['default_lang'] = 'english';
}
require($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_garage.' . $phpEx);
require($phpbb_root_path . 'language/lang_' . $board_config['default_lang'] . '/lang_garage_error.' . $phpEx);
require($phpbb_root_path . 'includes/class_garage_vehicle.' . $phpEx);
$garage_vehicle->profile_integration($profiledata['user_id']);

# 
#-----[ OPEN ]----- 
# 
language/lang_english/lang_main.php

#
#-----[ FIND ]------------------------------------------
#
$lang['Viewing_Garage'] = 'Viewing Garage';

#
#-----[ AFTER, ADD ]------------------------------------------
#
$lang['View_Users_Garage'] = 'View user\'s Garage';

# 
#-----[ OPEN ]----- 
# 
templates/subSilver/memberlist_body.tpl

#
#-----[ FIND ]------------------------------------------
#
	  <th class="thTop" nowrap="nowrap">{L_POSTS}</th>
#
#-----[ AFTER, ADD ]------------------------------------------
#
	  <th class="thTop" nowrap="nowrap">{L_GARAGE}</th>
#
#-----[ FIND ]------------------------------------------
#
	  <td class="{memberrow.ROW_CLASS}" align="center">&nbsp;{memberrow.WWW_IMG}&nbsp;</td>
#
#-----[ BEFORE, ADD ]------------------------------------------
#
	  <td class="{memberrow.ROW_CLASS}" align="center">&nbsp;{memberrow.GARAGE_IMG}&nbsp;</td>
#
#-----[ FIND ]------------------------------------------
#
	  <td class="catBottom" colspan="8" height="28">&nbsp;</td>
#
#-----[ REPLACE WITH ]------------------------------------------
#
	  <td class="catBottom" colspan="9" height="28">&nbsp;</td>

# 
#-----[ OPEN ]----- 
# 
templates/subSilver/viewtopic_body.tpl

#
#-----[ FIND ]------------------------------------------
#
# this is a partial search : the full line is longer
				<td valign="middle" nowrap="nowrap">{postrow.PROFILE_IMG}
#
#-----[ IN-LINE FIND ]------------------------------------------
#
{postrow.PROFILE_IMG}
#
#-----[ IN-LINE AFTER, ADD ]------------------------------------------
#
 {postrow.GARAGE_IMG}

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
