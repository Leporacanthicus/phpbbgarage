#############################################################################################################
## MOD Title:		phpBB Garage 1.2.0
## MOD Author: poyntesm < esmond.poynton[at]gmail[dot]com > (Esmond Poynton) http://forums.phpbbgarage.com/
## MOD Description:
##			This mod allows users of your forum to add details about their vehicles.
##
## MOD Version:		1.2.0 
## 
## Installation Level:	Easy
## Installation Time:	15 Minutes
## Files To Edit: (13)
## 			viewtopic.php
## 			viewonline.php
## 			includes/constants.php
## 			includes/page_header.php
## 			includes/page_tail.php
##                      profilcp/def/def_userfields.php
##                      profilcp/def/def_userfuncs_custom.php
##                      profilcp/def/def_usermaps.php
##			language/lang_english/lang_admin.php
##			language/lang_english/lang_main.php
## 			templates/subSilver/subSilver.cfg
## 			templates/subSilver/overall_footer.tpl
##			templates/subSilver/overall_header.tpl
##
## Included Files: (89)
##			Install Garage.txt
##			READ ME FIRST.txt
##			Upgrade.txt
##			contrib/Install Garage PCP.txt
##			contrib/profilcp/
##			contrib/templates/
## 			root/garage.php
## 			root/install_garage.php
##			root/admin/admin_garage_business.php
##			root/admin/admin_garage_categories.php
##			root/admin/admin_garage_config.php
##			root/admin/admin_garage_models.php
##			root/admin/admin_garage_permissions.php
##			root/admin/admin_garage_tools.php
##			root/includes/functions_garage.php
##			root/language/lang_english/lang_garage.php
##			root/language/lang_english/lang_garage_error.php
##			root/templates/subSilver/garage.tpl
##			root/templates/subSilver/garage_browse.tpl
##			root/templates/subSilver/garage_browse_insurance.tpl
##			root/templates/subSilver/garage_edit_comment.tpl
##			root/templates/subSilver/garage_error.tpl
##			root/templates/subSilver/garage_footer.tpl
##			root/templates/subSilver/garage_header.tpl
##			root/templates/subSilver/garage_insurance.tpl
##			root/templates/subSilver/garage_manage_vehicle_gallery.tpl
##			root/templates/subSilver/garage_menu.tpl
##			root/templates/subSilver/garage_modification.tpl
##			root/templates/subSilver/garage_pending.tpl
##			root/templates/subSilver/garage_quartermile.tpl
##			root/templates/subSilver/garage_quartermile_table.tpl
##			root/templates/subSilver/garage_reassign_business.tpl
##			root/templates/subSilver/garage_rollingroad.tpl
##			root/templates/subSilver/garage_rollingroad_table.tpl
##			root/templates/subSilver/garage_search.tpl
##			root/templates/subSilver/garage_user_submit.tpl
##			root/templates/subSilver/garage_user_submit_make.tpl
##			root/templates/subSilver/garage_user_submit_model.tpl
##			root/templates/subSilver/garage_vehicle.tpl
##			root/templates/subSilver/garage_vehicle_select_javascript.tpl
##			root/templates/subSilver/garage_view_garage_business.tpl
##			root/templates/subSilver/garage_view_guestbook.tpl
##			root/templates/subSilver/garage_view_insurance_business.tpl
##			root/templates/subSilver/garage_view_modification.tpl
##			root/templates/subSilver/garage_view_shop_business.tpl
##			root/templates/subSilver/garage_view_vehicle.tpl
##			root/templates/subSilver/admin/garage_business.tpl
##			root/templates/subSilver/admin/garage_business_edit.tpl
##			root/templates/subSilver/admin/garage_category.tpl
##			root/templates/subSilver/admin/garage_category_delete_body.tpl
##			root/templates/subSilver/admin/garage_category_edit_body.tpl
##			root/templates/subSilver/admin/garage_config.tpl
##			root/templates/subSilver/admin/garage_message.tpl
##			root/templates/subSilver/admin/garage_model.tpl
##			root/templates/subSilver/admin/garage_model_delete.tpl
##			root/templates/subSilver/admin/garage_model_edit.tpl
##			root/templates/subSilver/admin/garage_orphans.tpl
##			root/templates/subSilver/admin/garage_permissions.tpl
##			root/templates/subSilver/admin/garage_tools.tpl
##			root/templates/subSilver/images/garage_camera.gif
##			root/templates/subSilver/images/garage_slip.gif
##			root/templates/subSilver/images/lang_english/garage_add_insurance.gif
##			root/templates/subSilver/images/lang_english/garage_add_modification.gif
##			root/templates/subSilver/images/lang_english/garage_add_quartermile.gif
##			root/templates/subSilver/images/lang_english/garage_add_rollingroad.gif
##			root/templates/subSilver/images/lang_english/garage_browse.gif
##			root/templates/subSilver/images/lang_english/garage_create_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_delete.gif
##			root/templates/subSilver/images/lang_english/garage_delete_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_edit.gif
##			root/templates/subSilver/images/lang_english/garage_edit_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_garage_review.gif
##			root/templates/subSilver/images/lang_english/garage_insurance_review.gif
##			root/templates/subSilver/images/lang_english/garage_main_menu.gif
##			root/templates/subSilver/images/lang_english/garage_main_vehicle.gif
##			root/templates/subSilver/images/lang_english/garage_manage_gallery.gif
##			root/templates/subSilver/images/lang_english/garage_no_thumb.gif
##			root/templates/subSilver/images/lang_english/garage_quartermile_table.gif
##			root/templates/subSilver/images/lang_english/garage_rollingroad_table.gif
##			root/templates/subSilver/images/lang_english/garage_search.gif
##			root/templates/subSilver/images/lang_english/garage_shop_review.gif
##			root/templates/subSilver/images/lang_english/garage_view_vehicle.gif
##			root/templates/subSilver/images/lang_english/icon_garage.gif
##			upgrade/upgrade_garage-1.0.0.txt
##			upgrade/upgrade_garage-1.0.0.php
##			upgrade/upgrade_garage-1.0.2.txt
##			upgrade/upgrade_garage-1.0.2.php
##			upgrade/upgrade_garage-1.0.3.txt
##			upgrade/upgrade_garage-1.0.3.php
## License: http://opensource.org/licenses/gpl-license.php GNU General Public License v2 or any later version
######################################################################################
## For security purposes, please check: http://www.phpbb.com/mods/
## for the latest version of this MOD. Although MODs are checked
## before being allowed in the MODs Database there is no guarantee
## that there are no security problems within the MOD. No support
## will be given for MODs not found within the MODs Database which
## can be found at http://www.phpbb.com/mods/
###################################################################################### 
## Author Notes: 
##
##	- This Mod Was Inspired By IPB Based Garage By Matthew C. Veno
##
######################################################################################
## MOD History: 
##   xx-xx-2006 - Version 1.2.0
##	- Add 'DENY' permission
##	- Add vehicle quotas by group
## 	- Add upload image quotas by group
## 	- Add remote image quotas by group
## 	- Add disk space limits
##
##   18-04-2006 - Version 1.0.3
##	- Add support for MySQL5
##
##   27-02-2006 - Version 1.0.2
##	- Fix javascript error on adding a new model
##	- Fix setting private permissions
##	- Fix offset year
##	- Fix userlink in viewing insurance business
##
##   01-02-2006 - Version 1.0.0
##	- Version Submitted To phpBB.com's MOD DB. (Resubmitted with changes 01-02-2006)
##	- Version Submitted To phpBB.com's MOD DB. (Resubmitted with one change 08-01-2006)
##
###################################################################################### 
## Before Adding This MOD To Your Forum, You Should Back Up All Files Related To This MOD 
###################################################################################### 

#
#-----[ COPY ]------------------------------------------
#
copy root/*.* TO *.*

#
#-----[ DIY INSTRUCTIONS ]------------------------------------------
#
Create directory ./garage 
Create directory ./garage/upload 
Chmod ./garage/ to 755
Chmod ./garage/upload to 777
Open your web browser and run install_garage.php
Delete install_garage.php if it ran succesfully

# 
#-----[ OPEN ]----- 
# 
viewtopic.php

#
#-----[ FIND ]------------------------------------------
#
<?php
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Garage ----------------------------------------------------------------------------------------------------------
#
#-----[ FIND ]------------------------------------------
#
# this is a partial search : the full line is longer
//
// Go ahead and pull all data for this topic
//
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- modify
#
#-----[ FIND ]------------------------------------------
#
# this is a partial search : the full line is longer
$sql = "SELECT u.username, u.user_id, u.user_posts, u.user_from
#
#-----[ IN-LINE FIND ]------------------------------------------
#

pt.post_text, pt.post_subject, pt.bbcode_uid

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------------
#
, g.made_year, makes.make, models.model, g.id as garage_id
#
#-----[ FIND ]------------------------------------------
#
	FROM " . POSTS_TABLE . " p, " . USERS_TABLE . " u, " . POSTS_TEXT_TABLE . " pt
#
#-----[ IN-LINE FIND ]------------------------------------------
#
FROM

#
#-----[ IN-LINE AFTER,ADD ]------------------------------------------
#
 (
#
#-----[ IN-LINE FIND ]------------------------------------------
#
pt

#
#-----[ IN-LINE AFTER,ADD ]------------------------------------------
#
 )

#
#-----[ AFTER, ADD ]------------------------------------------
#
		LEFT JOIN " . GARAGE_TABLE ." g ON ( g.member_id = p.poster_id and g.main_vehicle = 1)
                LEFT JOIN " . GARAGE_MAKES_TABLE . " makes ON (g.make_id = makes.id)
                LEFT JOIN " . GARAGE_MODELS_TABLE . " models ON (g.model_id = models.id)
#
#-----[ FIND ]------------------------------------------
#
	LIMIT $start, ".$board_config['posts_per_page'];
#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

# 
#-----[ OPEN ]----- 
# 
profilcp/def/def_userfuncs_custom.php

#
#-----[ FIND ]------------------------------------------
#
?>
#
#-----[ BEFORE, ADD ]------------------------------------------
#
//----------------------------------- 
// 
// garage mod output function 
// 
//----------------------------------- 
function pcp_output_garage($field_name, $view_userdata, $map_name='') 
{ 
   global $board_config, $phpbb_root_path, $phpEx, $lang, $images, $userdata, $db; 
   global $values_list, $tables_linked, $classes_fields, $user_maps, $user_fields; 

   $img = ''; 
   $res = '';
   $txt = '';
   if ( ($view_userdata['user_id'] != ANONYMOUS) ) 
   {

	$garage_id = $view_userdata['garage_id'];

	$poster_car_year = ( $view_userdata['made_year'] && $view_userdata['user_id'] != ANONYMOUS ) ? $lang[''] . ' ' . $view_userdata['made_year'] : '';
	$poster_car_make = ( $view_userdata['make'] && $view_userdata['user_id'] != ANONYMOUS ) ? $lang[''] . ' ' . $view_userdata['make'] : '';
	$poster_car_model = ( $view_userdata['model'] && $view_userdata['user_id'] != ANONYMOUS ) ? $lang[''] . ' ' . $view_userdata['model'] : '';
}
	$poster_carprofile = ($userdata['user_level'] != ADMIN)? append_sid("garage.$phpEx?mode=view_vehicle&amp;CID=" . $garage_id) : append_sid("garage.$phpEx?mode=view_vehicle&amp;CID=" . $garage_id);

	$txt = '<a href="'. $poster_carprofile . '">'. $poster_car_year . $poster_car_make . $poster_car_model .'</a>';

    $res = pcp_output_format($field_name, $txt, $img, $map_name);  
   return $res; 
}
# 
#-----[ OPEN ]----- 
# 
viewonline.php

#
#-----[ FIND ]------------------------------------------
#
<?php

#
#-----[ AFTER, ADD ]------------------------------------------
#
//-- mod : Garage ----------------------------------------------------------------------------------------------------------
# 
#-----[ FIND ]----- 
# 

				case PAGE_FAQ:
					$location = $lang['Viewing_FAQ'];
					$location_url = "faq.$phpEx";
					break;
#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
				case PAGE_GARAGE:
					$location = $lang['Viewing_Garage'];
					$location_url = "garage.$phpEx";
					break;
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

# 
#-----[ OPEN ]----- 
# 
includes/constants.php

#
#-----[ FIND ]------------------------------------------
#
<?php

#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : Garage ----------------------------------------------------------------------------------------------------------


#
#-----[ FIND ]------------------------------------------
#

?>

#
#-----[ BEFORE, ADD ]------------------------------------------
#

//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
define('GARAGE_TABLE', $table_prefix.'garage');
define('GARAGE_CONFIG_TABLE', $table_prefix.'garage_config');
define('GARAGE_CATEGORIES_TABLE', $table_prefix.'garage_categories');
define('GARAGE_GALLERY_TABLE', $table_prefix.'garage_gallery');
define('GARAGE_GUESTBOOKS_TABLE', $table_prefix.'garage_guestbooks');
define('GARAGE_IMAGES_TABLE', $table_prefix.'garage_images');
define('GARAGE_MAKES_TABLE', $table_prefix.'garage_makes');
define('GARAGE_MODELS_TABLE', $table_prefix.'garage_models');
define('GARAGE_MODS_TABLE', $table_prefix.'garage_mods');
define('GARAGE_QUARTERMILE_TABLE', $table_prefix.'garage_quartermile');
define('GARAGE_ROLLINGROAD_TABLE', $table_prefix.'garage_rollingroad');
define('GARAGE_BUSINESS_TABLE', $table_prefix.'garage_business');
define('GARAGE_INSURANCE_TABLE', $table_prefix.'garage_insurance');
define('GARAGE_RATING_TABLE', $table_prefix.'garage_rating');
define('GARAGE_VEHICLE_FIELDS_TABLE', $table_prefix.'garage_vehicle_fields');
define('GARAGE_VEHICLE_FIELDS_DATA_TABLE', $table_prefix.'garage_vehicle_fields_data');
define('GARAGE_VEHICLE_FIELDS_LANG_TABLE', $table_prefix.'garage_vehicle_fields_lang');
define('GARAGE_VEHICLE_LANG_TABLE', $table_prefix.'garage_vehicle_lang');
define('GARAGE_UPLOAD_PATH', 'garage/upload/');
define('PAGE_GARAGE', -2120);
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

# 
#-----[ OPEN ]----- 
# 
includes/page_tail.php

#
#-----[ FIND ]------------------------------------------
#
<?php

#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : Garage ----------------------------------------------------------------------------------------------------------


# 
#-----[ FIND ]----- 
# 

$admin_link = ( $userdata['user_level'] == ADMIN ) ? '<a href="admin/index.' . $phpEx . '?sid=' . $userdata['session_id'] . '">' . $lang['Admin_panel'] . '</a><br /><br />' : '';

#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
include_once($phpbb_root_path . 'includes/class_garage.' . $phpEx);
if ( in_array($userdata['user_level'], array(ADMIN, MOD)) )
{
	//If Pending Items Exist Then Create Link
	if ( $garage->check_pending_items() )
	{
		$temp_url = append_sid("garage.$phpEx?mode=garage_pending");
		$pending_link = '<a href="'.$temp_url.'">' . $lang['Pending_Items'] . '</a>&nbsp;&nbsp;';
		$template->assign_vars(array(
			'PENDING_LINK' => $pending_link)
		);
	}
}
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

# 
#-----[ OPEN ]------------------------------------------
# 
language/lang_english/lang_admin.php

#
#-----[ FIND ]------------------------------------------
#
<?php

#
#-----[ AFTER, ADD ]------------------------------------
#
//-- mod : Garage ----------------------------------------------------------------------------------------------------------
#
#-----[ FIND ]------------------------------------------
#
?>

#
#-----[ BEFORE, ADD ]------------------------------------
#
//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
$lang['Business'] = 'Business';
$lang['Categories'] = 'Categories';
$lang['Configuration'] = 'Configuration';
$lang['Makes & Models'] = 'Makes & Models';
$lang['Permissions'] = 'Permissions';
$lang['Tools'] = 'Tools';
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

# 
#-----[ OPEN ]----- 
# 
language/lang_english/lang_main.php

#
#-----[ FIND ]------------------------------------------
#
<?php

#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : Garage ----------------------------------------------------------------------------------------------------------


# 
#-----[ FIND ]----- 
# 
 
//
// That's all, Folks!
// -------------------------------------------------

#
#-----[ BEFORE, ADD ]------------------------------------------
#

//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
$lang['Garage'] = 'Garage';
$lang['Viewing_Garage'] = 'Viewing Garage';
$lang['Quartermile_Table'] = '1/4 Mile Table';
$lang['Pending_Items'] = 'View Pending Garage Items';
$lang['profilcp_garage_shortcut'] = 'Garage';
$lang['profilcp_garage_pagetitle'] = 'Garage';
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

# 
#-----[ OPEN ]----- 
# 
profilcp/def/def_userfields.php

#
#-----[ FIND ]------------------------------------------
# You sjould have this line but if not you'll clearly see where to add this towards the bottom of the file
#
	// messangers informations
#
#-----[ BEFORE, ADD ]------------------------------------------
#
	'user_garage' => array(
		'lang_key'     => 'Garage',
		'class'        => 'generic',
		'type'         => 'VARCHAR',
		'dsp_func'     => 'pcp_output_garage',
	),
# 
#-----[ OPEN ]----- 
# 
profilcp/def/def_usermaps.php

#
#-----[ FIND ]------------------------------------------
#
		),
	),

	'PHPBB.viewtopic.left.ignore' => array(
#
#-----[ BEFORE, ADD ]------------------------------------------
# If you don't want it centered then just change it to left in the style section
#
         'user_garage' => array(
            'dsp_func'     => 'pcp_output_garage',
            'txt'          => true,
            'style'        => '<div align="center" class="gensmall">%s</div>',
         ),

# 
#-----[ OPEN ]----- 
# 
templates/subSilver/overall_footer.tpl

#
#-----[ FIND ]------------------------------------------
#

<div align="center"><span class="copyright"><br />
#
#-----[ IN-LINE FIND ]------------------------------------------
#

<span class="copyright"><br />
#
#-----[ IN-LINE AFTER, ADD ]------------------------------------------
#

{PENDING_LINK}

# 
#-----[ OPEN ]----- 
# 
templates/subSilver/overall_header.tpl

#
#-----[ FIND ]------------------------------------------
#

<td align="center" valign="top" nowrap="nowrap"><span class="mainmenu">

#
#-----[ IN-LINE FIND ]------------------------------------------
#

<span class="mainmenu">&nbsp;

#
#-----[ IN-LINE AFTER, ADD ]------------------------------------------
#

<img src="templates/subSilver/images/icon_mini_members.gif" width="12" height="13" border="0" alt="Garage" hspace="3" /><a href="garage.php" class="mainmenu">Garage</a>&nbsp;<img src="templates/subSilver/images/icon_mini_members.gif" width="12" height="13" border="0" alt="1/4 Mile Table" hspace="3" /><a href="garage.php?mode=quartermile" class="mainmenu">1/4 Mile Table</a>&nbsp;

# 
#-----[ OPEN ]----- 
# 
templates/subSilver/subSilver.cfg

#
#-----[ FIND ]------------------------------------------
#
<?php

#
#-----[ AFTER, ADD ]------------------------------------------
#

//-- mod : Garage ----------------------------------------------------------------------------------------------------------

#
#-----[ FIND ]------------------------------------------
#

?>

#
#-----[ BEFORE, ADD ]------------------------------------------
#

//-- mod start : Garage ----------------------------------------------------------------------------------------------------
//-- add
$images['vehicle_image_attached']	= "$current_template_images/garage_camera.gif";
$images['slip_image_attached']		= "$current_template_images/garage_slip.gif";
$images['icon_garage']			= "$current_template_images/{LANG}/icon_garage.gif";
$images['garage_main_menu']		= "$current_template_images/{LANG}/garage_main_menu.gif";
$images['garage_browse']		= "$current_template_images/{LANG}/garage_browse.gif";
$images['garage_search']		= "$current_template_images/{LANG}/garage_search.gif";
$images['garage_quartermile_table']	= "$current_template_images/{LANG}/garage_quartermile_table.gif";
$images['garage_rollingroad_table']	= "$current_template_images/{LANG}/garage_rollingroad_table.gif";
$images['garage_garage_review']		= "$current_template_images/{LANG}/garage_garage_review.gif";
$images['garage_shop_review']		= "$current_template_images/{LANG}/garage_shop_review.gif";
$images['garage_insurance_review']	= "$current_template_images/{LANG}/garage_insurance_review.gif";
$images['garage_create_vehicle']	= "$current_template_images/{LANG}/garage_create_vehicle.gif";
$images['garage_edit_vehicle']		= "$current_template_images/{LANG}/garage_edit_vehicle.gif";
$images['garage_delete_vehicle']	= "$current_template_images/{LANG}/garage_delete_vehicle.gif";
$images['garage_view_vehicle']		= "$current_template_images/{LANG}/garage_view_vehicle.gif";
$images['garage_add_modification']	= "$current_template_images/{LANG}/garage_add_modification.gif";
$images['garage_add_insurance']		= "$current_template_images/{LANG}/garage_add_insurance.gif";
$images['garage_add_rollingroad']	= "$current_template_images/{LANG}/garage_add_rollingroad.gif";
$images['garage_add_quartermile']	= "$current_template_images/{LANG}/garage_add_quartermile.gif";
$images['garage_manage_gallery']	= "$current_template_images/{LANG}/garage_manage_gallery.gif";
$images['garage_edit']			= "$current_template_images/{LANG}/garage_edit.gif";
$images['garage_delete']		= "$current_template_images/{LANG}/garage_delete.gif";
$images['garage_main_vehicle']		= "$current_template_images/{LANG}/garage_main_vehicle.gif";
$images['garage_no_thumb']		= "$current_template_images/{LANG}/garage_no_thumb.gif";
$images['garage_show_details']		= "$current_template_images/{LANG}/garage_show_details.gif";
$images['garage_hide_details']		= "$current_template_images/{LANG}/garage_hide_details.gif";
$images['garage_move_up']		= "$current_template_images/{LANG}/garage_move_up.gif";
$images['garage_move_down']		= "$current_template_images/{LANG}/garage_move_down.gif";
$images['garage_set_approved']		= "$current_template_images/{LANG}/garage_set_approved.gif";
$images['garage_set_pending']		= "$current_template_images/{LANG}/garage_set_pending.gif";
//-- mod finish : Garage ---------------------------------------------------------------------------------------------------

#
#-----[ SAVE/CLOSE ALL FILES ]------------------------------------------
#
# EoM
